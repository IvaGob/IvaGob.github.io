{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import'../index.css';import TourDetails from'./TourDetails.jsx';import{getAuth}from\"firebase/auth\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TourCard=_ref=>{let{tour,index}=_ref;const[user,setUser]=useState(null);const[isOrdered,setIsOrdered]=useState(false);const[showDetails,setShowDetails]=useState(false);const getCurrentUser=async()=>{const auth=getAuth();const user=auth.currentUser;if(!user)return null;try{const idToken=await user.getIdToken();const response=await fetch(`${process.env.REACT_APP_API_URL}/api/currentUser`,{headers:{Authorization:`Bearer ${idToken}`}});if(!response.ok)throw new Error(\"Не вдалося отримати поточного користувача\");const data=await response.json();return data;}catch(error){console.error(\"Помилка отримання поточного користувача:\",error);return null;}};const checkIfTourOrdered=async email=>{try{const response=await fetch(`${process.env.REACT_APP_API_URL}/api/user/${email}`);if(!response.ok)throw new Error(\"Помилка отримання турів користувача\");const data=await response.json();return data.orderedTours.includes(tour.id);}catch(error){console.error(\"Помилка отримання турів користувача:\",error);return false;}};const orderTour=async()=>{const auth=getAuth();const user=auth.currentUser;if(!user){alert(\"Спочатку увійдіть у систему\");return;}try{const idToken=await user.getIdToken();const response=await fetch(`${process.env.REACT_APP_API_URL}/api/user/order`,{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:`Bearer ${idToken}`// залиш, якщо плануєш перевірку на сервері\n},body:JSON.stringify({email:user.email,tourId:tour.id})});if(!response.ok){const errorText=await response.text();throw new Error(`Не вдалося замовити тур. ${errorText}`);}setIsOrdered(true);console.log(`Тур з id=${tour.id} додано до замовлень`);closeDetails();}catch(error){console.error(\"Помилка при додаванні замовлення:\",error);alert(\"Виникла помилка при збереженні замовлення. Спробуйте ще раз.\");}};useEffect(()=>{(async()=>{const currentUser=await getCurrentUser();if(currentUser){setUser(currentUser);const ordered=await checkIfTourOrdered(currentUser.email);setIsOrdered(ordered);}})();},[tour.id]);const showTourDetails=()=>{setShowDetails(true);const backgroundDiv=document.getElementById(\"tourDivBackground\");backgroundDiv.style.display=\"flex\";};const closeDetails=()=>{setShowDetails(false);const backgroundDiv=document.getElementById(\"tourDivBackground\");backgroundDiv.style.display=\"none\";};return/*#__PURE__*/_jsxs(\"div\",{className:\"tourDiv\",id:tour.id,children:[/*#__PURE__*/_jsx(\"div\",{className:\"tourName\",children:/*#__PURE__*/_jsx(\"h1\",{children:tour.title})}),/*#__PURE__*/_jsxs(\"div\",{className:\"tourDescription\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"tourDescriptionImage\",children:/*#__PURE__*/_jsx(\"img\",{src:tour.img,alt:tour.title,className:\"tourImage\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"tourDescriptionText\",children:/*#__PURE__*/_jsx(\"h2\",{children:tour.description})})]}),/*#__PURE__*/_jsx(\"div\",{id:`map-${index}`,className:\"map-container\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"tourDivFooter\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"DurationDiv\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"DurationDivHead\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0422\\u0440\\u0438\\u0432\\u0430\\u043B\\u0456\\u0441\\u0442\\u044C\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"DurationDivText\",children:/*#__PURE__*/_jsx(\"h2\",{children:tour.duration})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"PriceDiv\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"PriceDivHead\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0426\\u0456\\u043D\\u0430\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"PriceDivText\",children:/*#__PURE__*/_jsxs(\"h2\",{children:[tour.price,\" \\u0433\\u0440\\u043D\"]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"tourOrder\",children:!isOrdered&&user&&/*#__PURE__*/_jsx(\"button\",{className:\"tourOrderButton\",onClick:showTourDetails,children:/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0417\\u0430\\u043C\\u043E\\u0432\\u0438\\u0442\\u0438\"})})})]}),showDetails&&/*#__PURE__*/_jsx(TourDetails,{tour:tour,onClose:closeDetails,onOrder:orderTour})]});};export default TourCard;","map":{"version":3,"names":["React","useEffect","useState","TourDetails","getAuth","jsx","_jsx","jsxs","_jsxs","TourCard","_ref","tour","index","user","setUser","isOrdered","setIsOrdered","showDetails","setShowDetails","getCurrentUser","auth","currentUser","idToken","getIdToken","response","fetch","process","env","REACT_APP_API_URL","headers","Authorization","ok","Error","data","json","error","console","checkIfTourOrdered","email","orderedTours","includes","id","orderTour","alert","method","body","JSON","stringify","tourId","errorText","text","log","closeDetails","ordered","showTourDetails","backgroundDiv","document","getElementById","style","display","className","children","title","src","img","alt","description","duration","price","onClick","onClose","onOrder"],"sources":["C:/Users/dacko/my-react-app/src/components/TourCard.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport '../index.css';\r\nimport TourDetails from './TourDetails.jsx';\r\nimport { getAuth } from \"firebase/auth\";\r\n\r\nconst TourCard = ({ tour, index }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [isOrdered, setIsOrdered] = useState(false);\r\n  const [showDetails, setShowDetails] = useState(false);\r\n\r\n  const getCurrentUser = async () => {\r\n    const auth = getAuth();\r\n    const user = auth.currentUser;\r\n\r\n    if (!user) return null;\r\n\r\n    try {\r\n      const idToken = await user.getIdToken();\r\n      const response = await fetch(`${process.env.REACT_APP_API_URL}/api/currentUser`, {\r\n        headers: {\r\n          Authorization: `Bearer ${idToken}`,\r\n        },\r\n      });\r\n\r\n      if (!response.ok) throw new Error(\"Не вдалося отримати поточного користувача\");\r\n\r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error) {\r\n      console.error(\"Помилка отримання поточного користувача:\", error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const checkIfTourOrdered = async (email) => {\r\n    try {\r\n      const response = await fetch(`${process.env.REACT_APP_API_URL}/api/user/${email}`);\r\n      if (!response.ok) throw new Error(\"Помилка отримання турів користувача\");\r\n\r\n      const data = await response.json();\r\n      return data.orderedTours.includes(tour.id);\r\n    } catch (error) {\r\n      console.error(\"Помилка отримання турів користувача:\", error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const orderTour = async () => { \r\n  const auth = getAuth();\r\n  const user = auth.currentUser;\r\n\r\n  if (!user) {\r\n    alert(\"Спочатку увійдіть у систему\");\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const idToken = await user.getIdToken();\r\n\r\n    const response = await fetch(`${process.env.REACT_APP_API_URL}/api/user/order`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${idToken}`, // залиш, якщо плануєш перевірку на сервері\r\n      },\r\n      body: JSON.stringify({ email: user.email, tourId: tour.id }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      throw new Error(`Не вдалося замовити тур. ${errorText}`);\r\n    }\r\n\r\n    setIsOrdered(true);\r\n    console.log(`Тур з id=${tour.id} додано до замовлень`);\r\n    closeDetails();\r\n  } catch (error) {\r\n    console.error(\"Помилка при додаванні замовлення:\", error);\r\n    alert(\"Виникла помилка при збереженні замовлення. Спробуйте ще раз.\");\r\n  }\r\n};\r\n\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const currentUser = await getCurrentUser();\r\n      if (currentUser) {\r\n        setUser(currentUser);\r\n        const ordered = await checkIfTourOrdered(currentUser.email);\r\n        setIsOrdered(ordered);\r\n      }\r\n    })();\r\n  }, [tour.id]);\r\n\r\n  const showTourDetails = () => {\r\n    setShowDetails(true);\r\n    const backgroundDiv = document.getElementById(\"tourDivBackground\");\r\n    backgroundDiv.style.display = \"flex\";\r\n  };\r\n\r\n  const closeDetails = () => {\r\n    setShowDetails(false);\r\n    const backgroundDiv = document.getElementById(\"tourDivBackground\");\r\n    backgroundDiv.style.display = \"none\";\r\n  };\r\n\r\n  return (\r\n    <div className=\"tourDiv\" id={tour.id}>\r\n      <div className=\"tourName\">\r\n        <h1>{tour.title}</h1>\r\n      </div>\r\n\r\n      <div className=\"tourDescription\">\r\n        <div className=\"tourDescriptionImage\">\r\n          <img src={tour.img} alt={tour.title} className=\"tourImage\" />\r\n        </div>\r\n        <div className=\"tourDescriptionText\">\r\n          <h2>{tour.description}</h2>\r\n        </div>\r\n      </div>\r\n\r\n      <div id={`map-${index}`} className=\"map-container\"></div>\r\n\r\n      <div className=\"tourDivFooter\">\r\n        <div className=\"DurationDiv\">\r\n          <div className=\"DurationDivHead\">\r\n            <h1>Тривалість</h1>\r\n          </div>\r\n          <div className=\"DurationDivText\">\r\n            <h2>{tour.duration}</h2>\r\n          </div>\r\n        </div>\r\n        <div className=\"PriceDiv\">\r\n          <div className=\"PriceDivHead\">\r\n            <h1>Ціна</h1>\r\n          </div>\r\n          <div className=\"PriceDivText\">\r\n            <h2>{tour.price} грн</h2>\r\n          </div>\r\n        </div>\r\n        <div className=\"tourOrder\">\r\n          {!isOrdered && user && (\r\n            <button className=\"tourOrderButton\" onClick={showTourDetails}>\r\n              <h2>Замовити</h2>\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {showDetails && <TourDetails tour={tour} onClose={closeDetails} onOrder={orderTour} />}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TourCard;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}