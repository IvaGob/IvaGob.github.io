{"ast":null,"code":"import React,{useEffect,useState,useRef}from\"react\";import L from\"leaflet\";import\"leaflet/dist/leaflet.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CardWithMap=_ref=>{let{tour,index,onRemove,user}=_ref;const[value,setValue]=useState(5);const[text,setText]=useState(\"\");const[alreadyReviewed,setAlreadyReviewed]=useState(false);const[feedbacks,setFeedbacks]=useState([]);const mapRef=useRef(null);// Завантаження відгуків + перевірка чи залишав відгук поточний користувач\nconst loadFeedbacks=async()=>{try{const response=await fetch(`http://localhost:5000/api/tour/${tour.id}/feedbacks`);if(!response.ok)throw new Error('Помилка отримання відгуків');const data=await response.json();setFeedbacks(data.feedbacks);if(user&&data.feedbacks.some(fb=>fb.userEmail===user.email)){setAlreadyReviewed(true);}}catch(error){console.error(\"Помилка завантаження відгуків:\",error);}};useEffect(()=>{loadFeedbacks();},[tour.id,user]);const handleAddFeedback=async()=>{if(!user){alert(\"Увійдіть, щоб залишити відгук.\");return;}try{const response=await fetch(`http://localhost:5000/api/tour/${tour.id}/feedback`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({value,text,userEmail:user.email})});const result=await response.json();if(!response.ok){alert(result.error||'Сталася помилка');return;}alert(\"Відгук успішно додано!\");setAlreadyReviewed(true);setText(\"\");loadFeedbacks();// Оновити список відгуків після додавання\n}catch(error){console.error(\"Помилка додавання відгуку:\",error);alert(\"Сталася помилка. Спробуйте ще раз.\");}};useEffect(()=>{var _tour$places$,_tour$places$2;const mapId=`map-${index}`;mapRef.current=L.map(mapId).setView([((_tour$places$=tour.places[0])===null||_tour$places$===void 0?void 0:_tour$places$.lat)||48.3,((_tour$places$2=tour.places[0])===null||_tour$places$2===void 0?void 0:_tour$places$2.lon)||24.5],8);L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",{attribution:'&copy; OpenStreetMap contributors'}).addTo(mapRef.current);tour.places.forEach(place=>{L.marker([place.lat,place.lon]).addTo(mapRef.current).bindPopup(`<b>${place.name}</b><br>${place.desc}`);});return()=>{var _mapRef$current;(_mapRef$current=mapRef.current)===null||_mapRef$current===void 0?void 0:_mapRef$current.remove();};},[tour.places,index]);return/*#__PURE__*/_jsxs(\"div\",{className:\"orderedTourDiv\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"closeButton\",onClick:()=>onRemove(tour.id),children:/*#__PURE__*/_jsx(\"img\",{src:\"img/back-button.png\",className:\"back-button\"})}),/*#__PURE__*/_jsx(\"h1\",{children:tour.title}),/*#__PURE__*/_jsx(\"h2\",{children:tour.description}),/*#__PURE__*/_jsx(\"div\",{id:`map-${index}`,className:\"map-container\",style:{height:\"300px\",width:\"100%\",marginTop:\"1rem\"}}),/*#__PURE__*/_jsxs(\"div\",{className:\"feedback-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0412\\u0456\\u0434\\u0433\\u0443\\u043A\\u0438:\"}),feedbacks.length>0?feedbacks.map(fb=>/*#__PURE__*/_jsxs(\"div\",{className:\"feedback-item\",children:[/*#__PURE__*/_jsx(\"strong\",{children:fb.userName}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041E\\u0446\\u0456\\u043D\\u043A\\u0430: \",fb.value,\"/5\"]}),/*#__PURE__*/_jsx(\"p\",{children:fb.text})]},fb.id)):/*#__PURE__*/_jsx(\"p\",{children:\"\\u0429\\u0435 \\u043D\\u0435\\u043C\\u0430\\u0454 \\u0432\\u0456\\u0434\\u0433\\u0443\\u043A\\u0456\\u0432.\"})]}),!alreadyReviewed?/*#__PURE__*/_jsxs(\"div\",{className:\"feedback-div\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0417\\u0430\\u043B\\u0438\\u0448\\u0456\\u0442\\u044C \\u0432\\u0456\\u0434\\u0433\\u0443\\u043A:\"}),/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u041E\\u0446\\u0456\\u043D\\u043A\\u0430:\",/*#__PURE__*/_jsx(\"select\",{value:value,onChange:e=>setValue(Number(e.target.value)),children:[5,4,3,2,1].map(v=>/*#__PURE__*/_jsx(\"option\",{value:v,children:v},v))})]}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"\\u0412\\u0430\\u0448 \\u043A\\u043E\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440...\",value:text,onChange:e=>setText(e.target.value),style:{width:\"100%\",minHeight:\"100px\",marginTop:\"10px\"}}),/*#__PURE__*/_jsx(\"button\",{onClick:handleAddFeedback,children:\"\\u041D\\u0430\\u0434\\u0456\\u0441\\u043B\\u0430\\u0442\\u0438 \\u0432\\u0456\\u0434\\u0433\\u0443\\u043A\"})]}):/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0412\\u0438 \\u0432\\u0436\\u0435 \\u0437\\u0430\\u043B\\u0438\\u0448\\u0438\\u043B\\u0438 \\u0432\\u0456\\u0434\\u0433\\u0443\\u043A \\u0434\\u043B\\u044F \\u0446\\u044C\\u043E\\u0433\\u043E \\u0442\\u0443\\u0440\\u0443.\"})]});};export default CardWithMap;","map":{"version":3,"names":["React","useEffect","useState","useRef","L","jsx","_jsx","jsxs","_jsxs","CardWithMap","_ref","tour","index","onRemove","user","value","setValue","text","setText","alreadyReviewed","setAlreadyReviewed","feedbacks","setFeedbacks","mapRef","loadFeedbacks","response","fetch","id","ok","Error","data","json","some","fb","userEmail","email","error","console","handleAddFeedback","alert","method","headers","body","JSON","stringify","result","_tour$places$","_tour$places$2","mapId","current","map","setView","places","lat","lon","tileLayer","attribution","addTo","forEach","place","marker","bindPopup","name","desc","_mapRef$current","remove","className","children","onClick","src","title","description","style","height","width","marginTop","length","userName","onChange","e","Number","target","v","placeholder","minHeight"],"sources":["C:/Users/dacko/my-react-app/src/components/CardWithMap.jsx"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet/dist/leaflet.css\";\r\n\r\nconst CardWithMap = ({ tour, index, onRemove, user }) => {\r\n  const [value, setValue] = useState(5);\r\n  const [text, setText] = useState(\"\");\r\n  const [alreadyReviewed, setAlreadyReviewed] = useState(false);\r\n  const [feedbacks, setFeedbacks] = useState([]);\r\n  const mapRef = useRef(null);\r\n\r\n  // Завантаження відгуків + перевірка чи залишав відгук поточний користувач\r\n  const loadFeedbacks = async () => {\r\n    try {\r\n      const response = await fetch(`http://localhost:5000/api/tour/${tour.id}/feedbacks`);\r\n      if (!response.ok) throw new Error('Помилка отримання відгуків');\r\n      const data = await response.json();\r\n      setFeedbacks(data.feedbacks);\r\n\r\n      if (user && data.feedbacks.some(fb => fb.userEmail === user.email)) {\r\n        setAlreadyReviewed(true);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Помилка завантаження відгуків:\", error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadFeedbacks();\r\n  }, [tour.id, user]);\r\n\r\n  const handleAddFeedback = async () => {\r\n    if (!user) {\r\n      alert(\"Увійдіть, щоб залишити відгук.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`http://localhost:5000/api/tour/${tour.id}/feedback`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          value,\r\n          text,\r\n          userEmail: user.email\r\n        }),\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (!response.ok) {\r\n        alert(result.error || 'Сталася помилка');\r\n        return;\r\n      }\r\n\r\n      alert(\"Відгук успішно додано!\");\r\n      setAlreadyReviewed(true);\r\n      setText(\"\");\r\n      loadFeedbacks(); // Оновити список відгуків після додавання\r\n    } catch (error) {\r\n      console.error(\"Помилка додавання відгуку:\", error);\r\n      alert(\"Сталася помилка. Спробуйте ще раз.\");\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const mapId = `map-${index}`;\r\n\r\n    mapRef.current = L.map(mapId).setView(\r\n      [tour.places[0]?.lat || 48.3, tour.places[0]?.lon || 24.5],\r\n      8\r\n    );\r\n\r\n    L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\r\n      attribution: '&copy; OpenStreetMap contributors',\r\n    }).addTo(mapRef.current);\r\n\r\n    tour.places.forEach((place) => {\r\n      L.marker([place.lat, place.lon])\r\n        .addTo(mapRef.current)\r\n        .bindPopup(`<b>${place.name}</b><br>${place.desc}`);\r\n    });\r\n\r\n    return () => {\r\n      mapRef.current?.remove();\r\n    };\r\n  }, [tour.places, index]);\r\n\r\n  return (\r\n    <div className=\"orderedTourDiv\">\r\n      <button className=\"closeButton\" onClick={() => onRemove(tour.id)}>\r\n        <img src=\"img/back-button.png\" className=\"back-button\" />\r\n      </button>\r\n      <h1>{tour.title}</h1>\r\n      <h2>{tour.description}</h2>\r\n      <div\r\n        id={`map-${index}`}\r\n        className=\"map-container\"\r\n        style={{ height: \"300px\", width: \"100%\", marginTop: \"1rem\" }}\r\n      ></div>\r\n\r\n      <div className=\"feedback-section\">\r\n        <h2>Відгуки:</h2>\r\n        {feedbacks.length > 0 ? (\r\n          feedbacks.map((fb) => (\r\n            <div key={fb.id} className=\"feedback-item\">\r\n              <strong>{fb.userName}</strong>\r\n              <p>Оцінка: {fb.value}/5</p>\r\n              <p>{fb.text}</p>\r\n            </div>\r\n          ))\r\n        ) : (\r\n          <p>Ще немає відгуків.</p>\r\n        )}\r\n      </div>\r\n\r\n      {!alreadyReviewed ? (\r\n        <div className=\"feedback-div\">\r\n          <h1>Залишіть відгук:</h1>\r\n          <label>\r\n            Оцінка:\r\n            <select value={value} onChange={(e) => setValue(Number(e.target.value))}>\r\n              {[5, 4, 3, 2, 1].map((v) => (\r\n                <option key={v} value={v}>{v}</option>\r\n              ))}\r\n            </select>\r\n          </label>\r\n          <textarea\r\n            placeholder=\"Ваш коментар...\"\r\n            value={text}\r\n            onChange={(e) => setText(e.target.value)}\r\n            style={{ width: \"100%\", minHeight: \"100px\", marginTop: \"10px\" }}\r\n          />\r\n          <button onClick={handleAddFeedback}>Надіслати відгук</button>\r\n        </div>\r\n      ) : (\r\n        <h3>Ви вже залишили відгук для цього туру.</h3>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CardWithMap;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}