{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{getAuth,onAuthStateChanged}from\"firebase/auth\";// Функція для отримання поточного користувача\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const getCurrentUser=async()=>{const auth=getAuth();const user=auth.currentUser;if(!user)return null;try{const idToken=await user.getIdToken();const response=await fetch(\"http://localhost:5000/api/currentUser\",{headers:{Authorization:`Bearer ${idToken}`}});if(!response.ok)throw new Error(\"Не вдалося отримати поточного користувача\");const data=await response.json();return data;}catch(error){console.error(\"Помилка отримання поточного користувача:\",error);return null;}};const UserProfile=()=>{const[user,setUser]=useState(null);const[formData,setFormData]=useState({firstName:\"\",lastName:\"\",phone:\"\"});const[orderedTours,setOrderedTours]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// Отримання поточного користувача\nuseEffect(()=>{const unsubscribe=onAuthStateChanged(getAuth(),async firebaseUser=>{if(firebaseUser){setUser(firebaseUser);// Отримуємо поточного користувача через функцію\nconst currentUserData=await getCurrentUser();if(currentUserData){// Якщо користувач знайдений, оновлюємо форму\nsetFormData({firstName:currentUserData.name||\"\",lastName:currentUserData.surname||\"\",phone:currentUserData.phone||\"\"});// Отримуємо замовлення користувача\nconst userResponse=await fetch(`/api/user/${firebaseUser.email}`);const userData=await userResponse.json();setOrderedTours(userData.orderedTours||[]);}else{setError(\"Не вдалося отримати дані користувача.\");}}setLoading(false);});return()=>unsubscribe();},[]);const handleChange=e=>{setFormData(prev=>({...prev,[e.target.name]:e.target.value}));};const handleSave=async()=>{if(!user)return;try{// Оновлюємо дані користувача через сервер\nconst response=await fetch(\"http://localhost:5000/api/user/order\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({email:user.email,name:formData.firstName,surname:formData.lastName,phone:formData.phone})});if(!response.ok){throw new Error(\"Помилка збереження даних.\");}const result=await response.json();alert(\"Дані успішно оновлено!\");}catch(error){console.error(\"Помилка при оновленні даних:\",error);alert(\"Помилка збереження даних.\");}};if(loading)return/*#__PURE__*/_jsx(\"div\",{children:\"\\u0417\\u0430\\u0432\\u0430\\u043D\\u0442\\u0430\\u0436\\u0435\\u043D\\u043D\\u044F...\"});if(!user)return/*#__PURE__*/_jsx(\"div\",{children:\"\\u0411\\u0443\\u0434\\u044C \\u043B\\u0430\\u0441\\u043A\\u0430, \\u0443\\u0432\\u0456\\u0439\\u0434\\u0456\\u0442\\u044C \\u0443 \\u0441\\u0438\\u0441\\u0442\\u0435\\u043C\\u0443.\"});return/*#__PURE__*/_jsxs(\"div\",{className:\"profile-container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u041F\\u0440\\u043E\\u0444\\u0456\\u043B\\u044C \\u043A\\u043E\\u0440\\u0438\\u0441\\u0442\\u0443\\u0432\\u0430\\u0447\\u0430\"}),/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u0406\\u043C\\u2019\\u044F:\",/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"firstName\",value:formData.firstName,onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u041F\\u0440\\u0456\\u0437\\u0432\\u0438\\u0449\\u0435:\",/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"lastName\",value:formData.lastName,onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u0422\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D:\",/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"phone\",value:formData.phone,onChange:handleChange})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,children:\"\\u0417\\u0431\\u0435\\u0440\\u0435\\u0433\\u0442\\u0438\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041C\\u043E\\u0457 \\u0437\\u0430\\u043C\\u043E\\u0432\\u043B\\u0435\\u043D\\u043D\\u044F\"}),orderedTours.length>0?/*#__PURE__*/_jsx(\"ul\",{children:orderedTours.map((tour,index)=>/*#__PURE__*/_jsx(\"li\",{children:tour},index))}):/*#__PURE__*/_jsx(\"p\",{children:\"\\u0423 \\u0432\\u0430\\u0441 \\u043D\\u0435\\u043C\\u0430\\u0454 \\u0437\\u0430\\u043C\\u043E\\u0432\\u043B\\u0435\\u043D\\u0438\\u0445 \\u0442\\u0443\\u0440\\u0456\\u0432.\"}),error&&/*#__PURE__*/_jsx(\"div\",{children:error})]});};export default UserProfile;","map":{"version":3,"names":["React","useEffect","useState","getAuth","onAuthStateChanged","jsx","_jsx","jsxs","_jsxs","getCurrentUser","auth","user","currentUser","idToken","getIdToken","response","fetch","headers","Authorization","ok","Error","data","json","error","console","UserProfile","setUser","formData","setFormData","firstName","lastName","phone","orderedTours","setOrderedTours","loading","setLoading","setError","unsubscribe","firebaseUser","currentUserData","name","surname","userResponse","email","userData","handleChange","e","prev","target","value","handleSave","method","body","JSON","stringify","result","alert","children","className","type","onChange","onClick","length","map","tour","index"],"sources":["C:/Users/dacko/my-react-app/src/pages/profile.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { getAuth, onAuthStateChanged } from \"firebase/auth\";\r\n\r\n// Функція для отримання поточного користувача\r\nconst getCurrentUser = async () => {\r\n  const auth = getAuth();\r\n  const user = auth.currentUser;\r\n\r\n  if (!user) return null;\r\n\r\n  try {\r\n    const idToken = await user.getIdToken();\r\n    const response = await fetch(\"http://localhost:5000/api/currentUser\", {\r\n      headers: {\r\n        Authorization: `Bearer ${idToken}`,\r\n      },\r\n    });\r\n\r\n    if (!response.ok) throw new Error(\"Не вдалося отримати поточного користувача\");\r\n\r\n    const data = await response.json();\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Помилка отримання поточного користувача:\", error);\r\n    return null;\r\n  }\r\n};\r\n\r\nconst UserProfile = () => {\r\n  const [user, setUser] = useState(null);\r\n  const [formData, setFormData] = useState({\r\n    firstName: \"\",\r\n    lastName: \"\",\r\n    phone: \"\",\r\n  });\r\n  const [orderedTours, setOrderedTours] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Отримання поточного користувача\r\n  useEffect(() => {\r\n    const unsubscribe = onAuthStateChanged(getAuth(), async (firebaseUser) => {\r\n      if (firebaseUser) {\r\n        setUser(firebaseUser);\r\n        \r\n        // Отримуємо поточного користувача через функцію\r\n        const currentUserData = await getCurrentUser();\r\n\r\n        if (currentUserData) {\r\n          // Якщо користувач знайдений, оновлюємо форму\r\n          setFormData({\r\n            firstName: currentUserData.name || \"\",\r\n            lastName: currentUserData.surname || \"\",\r\n            phone: currentUserData.phone || \"\",\r\n          });\r\n\r\n          // Отримуємо замовлення користувача\r\n          const userResponse = await fetch(`/api/user/${firebaseUser.email}`);\r\n          const userData = await userResponse.json();\r\n          setOrderedTours(userData.orderedTours || []);\r\n        } else {\r\n          setError(\"Не вдалося отримати дані користувача.\");\r\n        }\r\n      }\r\n      setLoading(false);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  const handleChange = (e) => {\r\n    setFormData((prev) => ({\r\n      ...prev,\r\n      [e.target.name]: e.target.value,\r\n    }));\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    if (!user) return;\r\n    try {\r\n      // Оновлюємо дані користувача через сервер\r\n      const response = await fetch(\"http://localhost:5000/api/user/order\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          email: user.email,\r\n          name: formData.firstName,\r\n          surname: formData.lastName,\r\n          phone: formData.phone,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(\"Помилка збереження даних.\");\r\n      }\r\n\r\n      const result = await response.json();\r\n      alert(\"Дані успішно оновлено!\");\r\n    } catch (error) {\r\n      console.error(\"Помилка при оновленні даних:\", error);\r\n      alert(\"Помилка збереження даних.\");\r\n    }\r\n  };\r\n\r\n  if (loading) return <div>Завантаження...</div>;\r\n  if (!user) return <div>Будь ласка, увійдіть у систему.</div>;\r\n\r\n  return (\r\n    <div className=\"profile-container\">\r\n      <h1>Профіль користувача</h1>\r\n      <label>\r\n        Ім’я:\r\n        <input\r\n          type=\"text\"\r\n          name=\"firstName\"\r\n          value={formData.firstName}\r\n          onChange={handleChange}\r\n        />\r\n      </label>\r\n      <label>\r\n        Прізвище:\r\n        <input\r\n          type=\"text\"\r\n          name=\"lastName\"\r\n          value={formData.lastName}\r\n          onChange={handleChange}\r\n        />\r\n      </label>\r\n      <label>\r\n        Телефон:\r\n        <input\r\n          type=\"text\"\r\n          name=\"phone\"\r\n          value={formData.phone}\r\n          onChange={handleChange}\r\n        />\r\n      </label>\r\n      <button onClick={handleSave}>Зберегти</button>\r\n\r\n      <h2>Мої замовлення</h2>\r\n      {orderedTours.length > 0 ? (\r\n        <ul>\r\n          {orderedTours.map((tour, index) => (\r\n            <li key={index}>{tour}</li>\r\n          ))}\r\n        </ul>\r\n      ) : (\r\n        <p>У вас немає замовлених турів.</p>\r\n      )}\r\n\r\n      {error && <div>{error}</div>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UserProfile;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}